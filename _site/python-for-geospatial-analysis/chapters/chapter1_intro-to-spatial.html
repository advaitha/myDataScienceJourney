<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GiveDirectly – chapter1_intro-to-spatial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">GiveDirectly</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true"><strong>Research Methods</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../research_methods/literature_review.html" class="sidebar-item-text sidebar-link">Predicting poverty</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../research_methods/ph_social_media.html" class="sidebar-item-text sidebar-link">Interpretable Poverty Mapping Using Social Media, Satellite Images and Geospatial Information</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../research_methods/nlp_wiki_wealth_pred.html" class="sidebar-item-text sidebar-link">Predicting Economic Development Using Geolocated wikipedia articles</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../research_methods/image_detection.html" class="sidebar-item-text sidebar-link">Generating Interpretable Poverty Maps using Object Detection in Satellite Images</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../research_methods/Tile2Vec.html" class="sidebar-item-text sidebar-link">Tile2Vec - Unsupervised representation learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../research_methods/poverty_mapping_deep_reinforcement.html" class="sidebar-item-text sidebar-link">Efficient Poverty Mapping using Deep Reinforcement Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../research_methods/new_directions.html" class="sidebar-item-text sidebar-link">New directions (Ideas)</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true"><strong>CDR Methods</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cdr_methods/phone_metadata.html" class="sidebar-item-text sidebar-link">Predicting poverty and wealth from Mobile phone metadata</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cdr_methods/cdr_features.html" class="sidebar-item-text sidebar-link">Mobile phone Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cdr_methods/resources.html" class="sidebar-item-text sidebar-link">Resources for analyzing CDR</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true"><strong>How to Measure poverty</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../how_to_measure_poverty/approches.html" class="sidebar-item-text sidebar-link">Approches to Measuring Poverty</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true"><strong>Data</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_sources_detecting_poverty/satellite_imagery.html" class="sidebar-item-text sidebar-link">Satellite Imagery</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_sources_detecting_poverty/survey_data.html" class="sidebar-item-text sidebar-link">Survey Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_sources_detecting_poverty/multispectral_remote_sensing.html" class="sidebar-item-text sidebar-link">Multi Spectral Remote Sensing</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true"><strong>Geograhic Data Processing</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../spatial_data_processing/geographic_data_formats.html" class="sidebar-item-text sidebar-link">Geographic Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../spatial_data_processing/plot_buildings_with_area.html" class="sidebar-item-text sidebar-link">Visualizing Buildings in a location along with its Area</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../spatial_data_processing/spatial_analysis.html" class="sidebar-item-text sidebar-link">Spatial Analysis using Geopandas</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../spatial_data_processing/crs.html" class="sidebar-item-text sidebar-link">Coordinate Reference Systems (CRS)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../spatial_data_processing/visualization.html" class="sidebar-item-text sidebar-link">Data Visualization using Folium</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../spatial_data_processing/osm_processing.html" class="sidebar-item-text sidebar-link">OpenStreetMap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../spatial_data_processing/raster_data_processing.html" class="sidebar-item-text sidebar-link">Converting Data from Raster to Tabular (Geometry) format</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true"><strong>Deep Learning Implementations</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../deeplearning_implementations/satellite_images_classification.html" class="sidebar-item-text sidebar-link">Satellite Images Classification</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true"><strong>Telecom Churn Prediction</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../telecom_churn_prediction/telecom_churn_eda.html" class="sidebar-item-text sidebar-link">EDA on Telecom Churn Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../telecom_churn_prediction/telecom_churn_prediction.html" class="sidebar-item-text sidebar-link">Telecom Churn Prediction</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true"><strong>Data Quality</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_quality/four_steps_to_data_quality.html" class="sidebar-item-text sidebar-link">Ensuring Data Quality</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_quality/setup_datasource.html" class="sidebar-item-text sidebar-link">Create a new Datasource</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_quality/generate_expectation.html" class="sidebar-item-text sidebar-link">Initialize a new Expectation Suite by profiling a batch of your data.</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_quality/run_checkpoint.html" class="sidebar-item-text sidebar-link">Create Checkpoint</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true"><strong>Data Privacy</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_privacy/basic_privacy_approaches.html" class="sidebar-item-text sidebar-link">Approaches to Data privacy</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data_privacy/differential_privacy.html" class="sidebar-item-text sidebar-link">Differential Privacy</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true"><strong>Distributed Processing</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../distributed_processing/fugue_intro.html" class="sidebar-item-text sidebar-link">Fugue</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../distributed_processing/fugue_quickstart.html" class="sidebar-item-text sidebar-link">Fugue Quickstart</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../distributed_processing/fugue_sql.html" class="sidebar-item-text sidebar-link">FugueSQL</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true"><strong>About Me</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about_me/project_portfolio.html" class="sidebar-item-text sidebar-link">Project Portfolio</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about_me/why_me.html" class="sidebar-item-text sidebar-link">Why me</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-1-introduction-to-spatial-data" id="toc-chapter-1-introduction-to-spatial-data" class="nav-link active" data-scroll-target="#chapter-1-introduction-to-spatial-data">Chapter 1: Introduction to Spatial Data</a>
  <ul class="collapse">
  <li><a href="#chapter-outline" id="toc-chapter-outline" class="nav-link" data-scroll-target="#chapter-outline">Chapter Outline</a></li>
  <li><a href="#chapter-learning-objectives" id="toc-chapter-learning-objectives" class="nav-link" data-scroll-target="#chapter-learning-objectives">Chapter Learning Objectives</a></li>
  <li><a href="#imports" id="toc-imports" class="nav-link" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#introduction-to-spatial-data" id="toc-introduction-to-spatial-data" class="nav-link" data-scroll-target="#introduction-to-spatial-data">1. Introduction to spatial data</a></li>
  <li><a href="#working-with-vector-data" id="toc-working-with-vector-data" class="nav-link" data-scroll-target="#working-with-vector-data">2. Working with vector data</a>
  <ul class="collapse">
  <li><a href="#vector-data" id="toc-vector-data" class="nav-link" data-scroll-target="#vector-data">2.1. Vector data</a></li>
  <li><a href="#geopandas" id="toc-geopandas" class="nav-link" data-scroll-target="#geopandas">2.2. Geopandas</a></li>
  <li><a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data">2.3. Loading data</a></li>
  <li><a href="#making-data" id="toc-making-data" class="nav-link" data-scroll-target="#making-data">2.3. Making data</a></li>
  <li><a href="#loading-from-open-street-map" id="toc-loading-from-open-street-map" class="nav-link" data-scroll-target="#loading-from-open-street-map">2.4. Loading from Open Street Map</a></li>
  <li><a href="#basic-wrangling" id="toc-basic-wrangling" class="nav-link" data-scroll-target="#basic-wrangling">2.5. Basic wrangling</a></li>
  </ul></li>
  <li><a href="#working-with-raster-data" id="toc-working-with-raster-data" class="nav-link" data-scroll-target="#working-with-raster-data">3. Working with raster data</a></li>
  <li><a href="#coordinate-reference-systems" id="toc-coordinate-reference-systems" class="nav-link" data-scroll-target="#coordinate-reference-systems">4. Coordinate reference systems</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<p><img src="../docs/banner.png" class="img-fluid"></p>
<section id="chapter-1-introduction-to-spatial-data" class="level1">
<h1>Chapter 1: Introduction to Spatial Data</h1>
<p><strong>Tomas Beuzen, 2021</strong></p>
<p><img src="img/map.png" class="img-fluid"></p>
<section id="chapter-outline" class="level2">
<h2 class="anchored" data-anchor-id="chapter-outline">Chapter Outline</h2>
<hr>
<div class="toc">
<ul class="toc-item">
<li>
<span><a href="#Chapter-Learning-Objectives" data-toc-modified-id="Chapter-Learning-Objectives-2">Chapter Learning Objectives</a></span>
</li>
<li>
<span><a href="#Imports" data-toc-modified-id="Imports-3">Imports</a></span>
</li>
<li>
<span><a href="#1.-Introduction-to-spatial-data" data-toc-modified-id="1.-Introduction-to-spatial-data-4">1. Introduction to spatial data</a></span>
</li>
<li>
<span><a href="#2.-Working-with-vector-data" data-toc-modified-id="2.-Working-with-vector-data-5">2. Working with vector data</a></span>
</li>
<li>
<span><a href="#3.-Working-with-raster-data" data-toc-modified-id="3.-Working-with-raster-data-6">3. Working with raster data</a></span>
</li>
<li>
<span><a href="#4.-Coordinate-reference-systems" data-toc-modified-id="4.-Coordinate-reference-systems-7">4. Coordinate reference systems</a></span>
</li>
</ul>
</div>
</section>
<section id="chapter-learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="chapter-learning-objectives">Chapter Learning Objectives</h2>
<hr>
<ul>
<li>Describe the difference between vector and raster data.</li>
<li>Load vector data into <code>geopandas</code>.</li>
<li>Plot vector data using the <code>geopandas</code> method <code>.plot()</code>.</li>
<li>Wrangle vector data using <code>geopandas</code> functions, methods, and attributes like <code>gpd.sjoin()</code>, <code>gpd.clip()</code>, <code>.length()</code>, <code>.buffer()</code>, etc.</li>
<li>Import data from OpenStreetMap using <code>osmnx</code>.</li>
<li>Read raster data with <code>rasterio</code>.</li>
<li>Describe at a high level why coordinate reference systems (CRS) are important and identify the CRS of a <code>geopandas</code> object using the <code>.crs</code> attribute and reproject it to another CRS using the <code>.to_crs()</code> method.</li>
</ul>
</section>
<section id="imports" class="level2">
<h2 class="anchored" data-anchor-id="imports">Imports</h2>
<hr>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> osmnx <span class="im">as</span> ox</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'ggplot'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">16</span>, <span class="st">'axes.labelweight'</span>: <span class="st">'bold'</span>, <span class="st">'figure.figsize'</span>: (<span class="dv">6</span>, <span class="dv">6</span>), <span class="st">'axes.edgecolor'</span>: <span class="st">'0.2'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction-to-spatial-data" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-spatial-data">1. Introduction to spatial data</h2>
<hr>
<p>Spatial data (or “geospatial” data) are data with location information. In this short course, we’ll learn to wrangle, plot, and model this kind of data to describe and understand its spatial information and dependence.</p>
<p>To get you excited about geospatial data, here’s a cool 3D map of UBC that we’ll build together next lecture:</p>
<div class="cell" data-tags="[&quot;hide-input&quot;]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>html</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>iframe src<span class="op">=</span><span class="st">"../_images/ubc-3d.html"</span> width<span class="op">=</span><span class="st">"80%"</span> height<span class="op">=</span><span class="st">"500"</span><span class="op">&gt;&lt;/</span>iframe<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe src="../_images/ubc-3d.html" width="80%" height="500"></iframe>
</div>
</div>
<p>The first thing we need to know is that there are two main data formats used to represent spatial data: 1. Vector format 2. Raster format</p>
</section>
<section id="working-with-vector-data" class="level2">
<h2 class="anchored" data-anchor-id="working-with-vector-data">2. Working with vector data</h2>
<hr>
<section id="vector-data" class="level3">
<h3 class="anchored" data-anchor-id="vector-data">2.1. Vector data</h3>
<p>Vector data is an intuitive and common spatial data format and the one we’ll focus on most in this chapter. Vector data is simply a collection of discrete locations (<code>(x, y)</code> values) called “vertices” that define one of three shapes: 1. <strong>Point</strong>: a single <code>(x, y)</code> point. Like the location of your house. 2. <strong>Line</strong>: two or more connected <code>(x, y)</code> points. Like a road. 3. <strong>Polygon</strong>: three or more <code>(x, y)</code> points connected and closed. Like a lake, or the border of a country.</p>
<p><img src="img/vector.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Source: <a href="https://github.com/NEONScience/NEON-Data-Skills">National Ecological Observatory Network</a>.</p>
</blockquote>
<p>Vector data is most commonly stored in a “shapefile”. A shapefile is actually composed of 3 required files with the same prefix (here, <code>spatial-data</code>) but different extensions: 1. <code>spatial-data.shp</code>: main file that stores records of each shape geometries 2. <code>spatial-data.shx</code>: index of how the geometries in the main file relate to one-another 3. <code>spatial-data.dbf</code>: attributes of each record</p>
<p>There are <a href="https://desktop.arcgis.com/en/arcmap/10.3/manage-data/shapefiles/shapefile-file-extensions.htm">other optional files</a> that may also be part of a shapefile but we won’t worry about them for now. Each shapefile can only contain one type of shape. For example, the descriptions for a house (point), a road (line), and a postal code area (polygon) would be stored in three separate shapefiles.</p>
<blockquote class="blockquote">
<p>There are other file-types for storing vector data too like <code>geojson</code>. These files can generally be imported into Python using the same methods and packages we use below.</p>
</blockquote>
</section>
<section id="geopandas" class="level3">
<h3 class="anchored" data-anchor-id="geopandas">2.2. Geopandas</h3>
<p>The Python <a href="https://geopandas.org/getting_started/introduction.html">geopandas</a> library is the main library we’ll be using to work with vector data in Python. It’s built off <code>shapely</code> (which is <em>the</em> Python library for working with geometric objects in Python) and <code>pandas</code>. Similar to <code>pandas</code>, <code>geopandas</code> provides two key classes for spatial data manipulation: 1. <code>GeoSeries</code>: just like a <code>pandas</code> series but stores geometries like points, lines, polygons (we’ll see that shortly) 2. <code>GeoDataFrame</code>: just like a <code>pandas</code> dataframe with one or more columns of regular series and one or more columns of <code>geoseries</code>.</p>
<p>Along with those classes, we also have a variety of cool geopstial wrangling methods which we’ll explore in this chapter. For now, here’s a schematic of a <code>GeoDataFrame</code>:</p>
<p><img src="img/geopandas.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Source: <a href="https://geopandas.org/getting_started/introduction.html">GeoPandas Documentation</a>.</p>
</blockquote>
<p>We usually import <code>geopandas</code> using the alias <code>gpd</code>:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-data">2.3. Loading data</h3>
<p>Let’s take a look at loading in a shapefile to a <code>GeoDataFrame</code> now. I downloaded a shapefile of Candian provinces from <a href="https://www12.statcan.gc.ca/census-recensement/2011/geo/bound-limit/bound-limit-2016-eng.cfm">statcan</a> as a shapefile that looks like this:</p>
<pre><code>provinces
├── provinces.dbf
├── provinces.shp
├── provinces.shx
└── provinces.prj  # this contains projection information which I'll dicuss later</code></pre>
<p>We can read that shapefile using <code>gpd.read_file()</code>:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> gpd.read_file(<span class="st">"data-spatial/provinces"</span>)  <span class="co"># note that I point to the shapefile "directory" containg all the individual files</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> provinces.to_crs(<span class="st">"EPSG:4326"</span>)    <span class="co"># I'll explain this later, I'm converting to a different coordinate reference system</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>provinces</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>PRUID</th>
      <th>PRNAME</th>
      <th>PRENAME</th>
      <th>PRFNAME</th>
      <th>PREABBR</th>
      <th>PRFABBR</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>Newfoundland and Labrador / Terre-Neuve-et-Lab...</td>
      <td>Newfoundland and Labrador</td>
      <td>Terre-Neuve-et-Labrador</td>
      <td>N.L.</td>
      <td>T.-N.-L.</td>
      <td>MULTIPOLYGON (((-57.40256 54.14965, -57.38429 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11</td>
      <td>Prince Edward Island / Île-du-Prince-Édouard</td>
      <td>Prince Edward Island</td>
      <td>Île-du-Prince-Édouard</td>
      <td>P.E.I.</td>
      <td>Î.-P.-É.</td>
      <td>MULTIPOLYGON (((-61.98300 46.45775, -61.98136 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12</td>
      <td>Nova Scotia / Nouvelle-Écosse</td>
      <td>Nova Scotia</td>
      <td>Nouvelle-Écosse</td>
      <td>N.S.</td>
      <td>N.-É.</td>
      <td>MULTIPOLYGON (((-61.90233 45.87878, -61.90057 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13</td>
      <td>New Brunswick / Nouveau-Brunswick</td>
      <td>New Brunswick</td>
      <td>Nouveau-Brunswick</td>
      <td>N.B.</td>
      <td>N.-B.</td>
      <td>MULTIPOLYGON (((-64.80155 47.80365, -64.80155 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24</td>
      <td>Quebec / Québec</td>
      <td>Quebec</td>
      <td>Québec</td>
      <td>Que.</td>
      <td>Qc</td>
      <td>MULTIPOLYGON (((-58.64703 51.20816, -58.63991 ...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>35</td>
      <td>Ontario</td>
      <td>Ontario</td>
      <td>Ontario</td>
      <td>Ont.</td>
      <td>Ont.</td>
      <td>MULTIPOLYGON (((-88.86612 56.84777, -88.86838 ...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>46</td>
      <td>Manitoba</td>
      <td>Manitoba</td>
      <td>Manitoba</td>
      <td>Man.</td>
      <td>Man.</td>
      <td>MULTIPOLYGON (((-94.82341 59.99352, -94.82398 ...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>47</td>
      <td>Saskatchewan</td>
      <td>Saskatchewan</td>
      <td>Saskatchewan</td>
      <td>Sask.</td>
      <td>Sask.</td>
      <td>POLYGON ((-109.63748 60.00005, -109.62498 60.0...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>48</td>
      <td>Alberta</td>
      <td>Alberta</td>
      <td>Alberta</td>
      <td>Alta.</td>
      <td>Alb.</td>
      <td>POLYGON ((-110.00001 59.95257, -110.00001 59.9...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>British Columbia</td>
      <td>Colombie-Britannique</td>
      <td>B.C.</td>
      <td>C.-B.</td>
      <td>MULTIPOLYGON (((-135.40000 60.00006, -135.3875...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>60</td>
      <td>Yukon</td>
      <td>Yukon</td>
      <td>Yukon</td>
      <td>Y.T.</td>
      <td>Yn</td>
      <td>MULTIPOLYGON (((-136.46988 68.86889, -136.4686...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>61</td>
      <td>Northwest Territories / Territoires du Nord-Ouest</td>
      <td>Northwest Territories</td>
      <td>Territoires du Nord-Ouest</td>
      <td>N.W.T.</td>
      <td>T.N.-O.</td>
      <td>MULTIPOLYGON (((-134.49321 69.70799, -134.4947...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>62</td>
      <td>Nunavut</td>
      <td>Nunavut</td>
      <td>Nunavut</td>
      <td>Nvt.</td>
      <td>Nt</td>
      <td>MULTIPOLYGON (((-94.65114 72.00040, -94.64164 ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(provinces)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
<p>Because <code>geopandas</code> is built off <code>pandas</code>, our <code>GeoDataFrame</code> inherits most of the same functionality as a regular dataframe. For example, let’s try the <code>.info()</code> method:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>provinces.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;
RangeIndex: 13 entries, 0 to 12
Data columns (total 7 columns):
 #   Column    Non-Null Count  Dtype   
---  ------    --------------  -----   
 0   PRUID     13 non-null     object  
 1   PRNAME    13 non-null     object  
 2   PRENAME   13 non-null     object  
 3   PRFNAME   13 non-null     object  
 4   PREABBR   13 non-null     object  
 5   PRFABBR   13 non-null     object  
 6   geometry  13 non-null     geometry
dtypes: geometry(1), object(6)
memory usage: 856.0+ bytes</code></pre>
</div>
</div>
<p>Note we have 5 columns of dtype “object” which typically means “strings” in <code>pandas</code>, and we have our one “geometry” column which contains vector data - polygons in this case. Well we have <code>MULTIPOLYGON</code>s which just means multiple polygons together, for example British Columbia has a lot of little islands, so to make a boundary of it, we need multiple polygons.</p>
<p><code>geopandas</code> has built-in plotting functionality (just like <code>pandas</code>) which is useful for making quick plots to visualize your data:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>provinces.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Canada Provinces and Territories"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>That looks like Canada to me! We can also index our <code>GeoDataFrame</code> just like a regular dataframe:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>provinces.iloc[[<span class="dv">0</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>PRUID</th>
      <th>PRNAME</th>
      <th>PRENAME</th>
      <th>PRFNAME</th>
      <th>PREABBR</th>
      <th>PRFABBR</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>Newfoundland and Labrador / Terre-Neuve-et-Lab...</td>
      <td>Newfoundland and Labrador</td>
      <td>Terre-Neuve-et-Labrador</td>
      <td>N.L.</td>
      <td>T.-N.-L.</td>
      <td>MULTIPOLYGON (((-57.40256 54.14965, -57.38429 ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> provinces.iloc[<span class="dv">0</span>][<span class="st">"PRENAME"</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>provinces.iloc[[<span class="dv">0</span>]].plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>plt.title(name)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Let’s filter our dataframe for only British Columbia using the helpful <code>pandas</code> method <code>.query()</code>:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>province <span class="op">=</span> <span class="st">"British Columbia"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>bc <span class="op">=</span> provinces.query(<span class="st">"PRENAME == @province"</span>).copy()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>bc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>PRUID</th>
      <th>PRNAME</th>
      <th>PRENAME</th>
      <th>PRFNAME</th>
      <th>PREABBR</th>
      <th>PRFABBR</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>British Columbia</td>
      <td>Colombie-Britannique</td>
      <td>B.C.</td>
      <td>C.-B.</td>
      <td>MULTIPOLYGON (((-135.40000 60.00006, -135.3875...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Now, let’s do some simple manipulation to clean up our dataframe:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>bc <span class="op">=</span> (bc.loc[:, [<span class="st">"PRENAME"</span>, <span class="st">"geometry"</span>]]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="st">"PRNAME"</span>: <span class="st">"Province"</span>})</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>bc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>PRENAME</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>British Columbia</td>
      <td>MULTIPOLYGON (((-135.40000 60.00006, -135.3875...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>bc.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"British Columbia"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="making-data" class="level3">
<h3 class="anchored" data-anchor-id="making-data">2.3. Making data</h3>
<p>Typically, you’ll be loading data from a file like we did above (or using an API as we’ll do later in this chapter). But we can also create our own vector data. Let’s create some “points” for BC’s biggest cities in a regular dataframe:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> pd.DataFrame(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"City"</span>: [<span class="st">"Vancouver"</span>, <span class="st">"Victoria"</span>, <span class="st">"Kelowna"</span>],</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Population"</span>: [<span class="dv">2_264_823</span>, <span class="dv">335_696</span>, <span class="dv">151_957</span>],</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Latitude"</span>: [<span class="fl">49.260833</span>, <span class="fl">48.428333</span>, <span class="fl">49.888056</span>],</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Longitude"</span>: [<span class="op">-</span><span class="fl">123.113889</span>, <span class="op">-</span><span class="fl">123.364722</span>, <span class="op">-</span><span class="fl">119.495556</span>],</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>City</th>
      <th>Population</th>
      <th>Latitude</th>
      <th>Longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Vancouver</td>
      <td>2264823</td>
      <td>49.260833</td>
      <td>-123.113889</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Victoria</td>
      <td>335696</td>
      <td>48.428333</td>
      <td>-123.364722</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Kelowna</td>
      <td>151957</td>
      <td>49.888056</td>
      <td>-119.495556</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can coerce that data into a <code>GeoDataFrame</code> using <code>gpd.GeoDataFrame()</code> and by using the function <code>gpd.points_from_xy()</code> to change our “Latitude” and “Longitude” columns to geometries:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> gpd.GeoDataFrame(cities,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                          crs<span class="op">=</span><span class="st">"EPSG:4326"</span>,  <span class="co"># I'll talk about this later</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                          geometry<span class="op">=</span>gpd.points_from_xy(cities[<span class="st">"Longitude"</span>], cities[<span class="st">"Latitude"</span>]))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>City</th>
      <th>Population</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Vancouver</td>
      <td>2264823</td>
      <td>49.260833</td>
      <td>-123.113889</td>
      <td>POINT (-123.11389 49.26083)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Victoria</td>
      <td>335696</td>
      <td>48.428333</td>
      <td>-123.364722</td>
      <td>POINT (-123.36472 48.42833)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Kelowna</td>
      <td>151957</td>
      <td>49.888056</td>
      <td>-119.495556</td>
      <td>POINT (-119.49556 49.88806)</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s plot those points on our map:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> bc.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cities.plot(ax<span class="op">=</span>ax, markersize<span class="op">=</span><span class="dv">180</span>, edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Big cities in B.C."</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="loading-from-open-street-map" class="level3">
<h3 class="anchored" data-anchor-id="loading-from-open-street-map">2.4. Loading from Open Street Map</h3>
<p>So we can read vector data from a file and we can create our own, but let’s see what real power feels like!</p>
<p><img src="img/real-power.gif" class="img-fluid"></p>
<p>Often it will be helpful to obtain data from an online source using an API. The most relevant “online source” here is <a href="https://www.openstreetmap.org/">OpenStreetMap (OSM)</a>, which is like the Wikipedia of geospatial data (think world map, road networks, bike networks, buidling heights, sandy coastlines, you name it). There are plenty of Python APIs for getting data from OSM but by far the best I’ve come across is <a href="https://github.com/gboeing/osmnx/tree/master">osmnx</a>:</p>
<pre class="console"><code>conda install -c conda-forge osmnx</code></pre>
<p><code>osmnx</code> provides an easy-to-use API to query OSM data. I usually import it with the alias <code>ox</code>. Let’s get a polygon of Vancouver now using the function <code>ox.geocode_to_gdf()</code>:</p>
<blockquote class="blockquote">
<p>By default <code>osmnx</code> caches responses locally in a folder <code>cache</code> so that you can quickly access data again without needing to call the API. You can turn this behaviour off if you wish.</p>
</blockquote>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> osmnx <span class="im">as</span> ox</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>vancouver <span class="op">=</span> ox.geocode_to_gdf(<span class="st">"Vancouver, Canada"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>vancouver.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Vancouver"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It’s certainly Vancouver, but it looks a bit blocky. It might be a bit low resolution, or someone just decided this was the best way to encapsulate “Vancouver” on OSM. Either way, let’s use this polygon to “clip” a section of our higher-resolution provinces data which we downloaded earlier (and which is the official shapefile downloaded from <a href="https://www12.statcan.gc.ca/census-recensement/2011/geo/bound-limit/bound-limit-2016-eng.cfm">statcan</a>).</p>
<p>This is the first geometric wrangling operation we’ll see. I’ll show some more later, but think of “clipping” as passing a top layer of cookie dough (the map above), over a bottom layer cookiecutter (our high-resolution provinces data) to get a shape out:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>van_bc <span class="op">=</span> gpd.clip(bc, vancouver)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>van_bc.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Vancouver"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>That looks better! Now we can clearly see Stanley Park at the top of the plot! Speaking of which, let’s get a polygon of Stanley Park:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>stanley_park <span class="op">=</span> ox.geocode_to_gdf(<span class="st">"Stanley Park, Vancouver"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And plot it on our map:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> van_bc.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>stanley_park.plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"0.2"</span>, color<span class="op">=</span><span class="st">"tomato"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Stanley Park"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Okay let’s do one last cool thing! Let’s use <code>osmnx</code> to get the bicycle network within Stanley Park! We can get networks like road, rail, bike, etc., using the function <code>ox.graph_from_place()</code>:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bike_network <span class="op">=</span> ox.graph_from_place(<span class="st">"Stanley Park, Vancouver"</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                                   network_type<span class="op">=</span><span class="st">"bike"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>bike_network</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>&lt;networkx.classes.multidigraph.MultiDiGraph at 0x13863b210&gt;</code></pre>
</div>
</div>
<p>As you can see, this returns a different object, a <a href="https://networkx.org/">networkx</a> <code>MultiDiGraph</code> which is a structure for holding network/graph-like objects such as road networks. We’re not interested in graph operations, we are just interested in geometries, so we’ll convert this to a <code>GeoDataFrame</code> using the function <code>ox.graph_to_gdfs()</code>:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bike_network <span class="op">=</span> (ox.graph_to_gdfs(bike_network, nodes<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                  .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                  .loc[:, [<span class="st">"name"</span>, <span class="st">"length"</span>, <span class="st">"bridge"</span>, <span class="st">"geometry"</span>]]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>bike_network</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>name</th>
      <th>length</th>
      <th>bridge</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Stanley Park Causeway</td>
      <td>165.216</td>
      <td>yes</td>
      <td>LINESTRING (-123.13719 49.29767, -123.13718 49...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Stanley Park Causeway</td>
      <td>62.901</td>
      <td>NaN</td>
      <td>LINESTRING (-123.13719 49.29767, -123.13741 49...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>8.066</td>
      <td>NaN</td>
      <td>LINESTRING (-123.13211 49.29737, -123.13212 49...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Stanley Park Drive</td>
      <td>80.558</td>
      <td>NaN</td>
      <td>LINESTRING (-123.13211 49.29737, -123.13204 49...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>91.001</td>
      <td>NaN</td>
      <td>LINESTRING (-123.13211 49.29737, -123.13212 49...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>361</th>
      <td>NaN</td>
      <td>12.670</td>
      <td>NaN</td>
      <td>LINESTRING (-123.12854 49.29693, -123.12863 49...</td>
    </tr>
    <tr>
      <th>362</th>
      <td>NaN</td>
      <td>44.325</td>
      <td>NaN</td>
      <td>LINESTRING (-123.12854 49.29693, -123.12869 49...</td>
    </tr>
    <tr>
      <th>363</th>
      <td>Stanley Park Drive</td>
      <td>3.339</td>
      <td>NaN</td>
      <td>LINESTRING (-123.14577 49.29042, -123.14572 49...</td>
    </tr>
    <tr>
      <th>364</th>
      <td>Park Lane</td>
      <td>29.437</td>
      <td>NaN</td>
      <td>LINESTRING (-123.14668 49.29078, -123.14658 49...</td>
    </tr>
    <tr>
      <th>365</th>
      <td>Stanley Park Drive</td>
      <td>48.880</td>
      <td>NaN</td>
      <td>LINESTRING (-123.14668 49.29078, -123.14670 49...</td>
    </tr>
  </tbody>
</table>
<p>366 rows × 4 columns</p>
</div>
</div>
</div>
<p>Now let’s plot this bike network on Stanley Park!</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> stanley_park.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>bike_network.plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"0.2"</span>, color<span class="op">=</span><span class="st">"tomato"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Stanley Park Cycling"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Amazing stuff!</p>
</section>
<section id="basic-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="basic-wrangling">2.5. Basic wrangling</h3>
<p>So we did some cool mapping and data manipulation above, but what’s it all for? Why would you want to do any of this? Well we can now start calculating and manipulating this spatial data to answer questions. Let’s answer some now.</p>
<section id="question-1-what-is-the-total-length-of-bike-lanes-in-stanley-park" class="level4">
<h4 class="anchored" data-anchor-id="question-1-what-is-the-total-length-of-bike-lanes-in-stanley-park">Question 1: What is the total length of bike lanes in Stanley Park?</h4>
<p>Well, our <code>GeoDataFrame</code> actually already has this information, it came for free from our original <code>ox.graph_from_place()</code> function and is in the “length” column:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>total_length <span class="op">=</span> bike_network[<span class="st">"length"</span>].<span class="bu">sum</span>()  <span class="co"># total length in m</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total bike lane length: </span><span class="sc">{</span>total_length <span class="op">/</span> <span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">km"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total bike lane length: 58km</code></pre>
</div>
</div>
<p>But even if we didn’t have this column, we could still calculate lengths based on our line geometries and the <code>.length</code> attribute:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bike_network[<span class="st">"geometry"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0      LINESTRING (-123.13719 49.29767, -123.13718 49...
1      LINESTRING (-123.13719 49.29767, -123.13741 49...
2      LINESTRING (-123.13211 49.29737, -123.13212 49...
3      LINESTRING (-123.13211 49.29737, -123.13204 49...
4      LINESTRING (-123.13211 49.29737, -123.13212 49...
                             ...                        
361    LINESTRING (-123.12854 49.29693, -123.12863 49...
362    LINESTRING (-123.12854 49.29693, -123.12869 49...
363    LINESTRING (-123.14577 49.29042, -123.14572 49...
364    LINESTRING (-123.14668 49.29078, -123.14658 49...
365    LINESTRING (-123.14668 49.29078, -123.14670 49...
Name: geometry, Length: 366, dtype: geometry</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>bike_network[<span class="st">"geometry"</span>].length</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/miniconda3/envs/mds574/lib/python3.7/site-packages/ipykernel_launcher.py:1: UserWarning: Geometry is in a geographic CRS. Results from 'length' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

  """Entry point for launching an IPython kernel.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0      0.001653
1      0.000751
2      0.000073
3      0.001029
4      0.001151
         ...   
361    0.000133
362    0.000477
363    0.000044
364    0.000393
365    0.000628
Length: 366, dtype: float64</code></pre>
</div>
</div>
<p>What’s that warning? More on that a bit later, but it’s telling us that our coordinate system has units of degrees - not linear units like meters which would be better for calculating distances. I’m going to convert my geometries to a coordinate systems based on linear units (meters). I’ll specify the projection “EPSG:3347” (Lambert projection) which is the one used by <a href="https://www150.statcan.gc.ca/n1/pub/92-195-x/2011001/other-autre/mapproj-projcarte/m-c-eng.htm">statcan</a>:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bike_network <span class="op">=</span> bike_network.to_crs(<span class="st">"EPSG:3347"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>bike_network[<span class="st">"geometry"</span>].length</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0      165.142206
1       62.941716
2        8.058879
3       80.655282
4       91.110800
          ...    
361     12.667118
362     44.326065
363      3.343832
364     29.484229
365     48.942512
Length: 366, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>total_length <span class="op">=</span> bike_network[<span class="st">"geometry"</span>].length.<span class="bu">sum</span>()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total bike lane length: </span><span class="sc">{</span>total_length <span class="op">/</span> <span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">km"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total bike lane length: 58km</code></pre>
</div>
</div>
<p>The same as we got before! Nice!</p>
</section>
<section id="question-2-what-percentage-of-the-area-of-stanley-park-is-bike-lanes" class="level4">
<h4 class="anchored" data-anchor-id="question-2-what-percentage-of-the-area-of-stanley-park-is-bike-lanes">Question 2: What percentage of the area of Stanley Park is bike lanes?</h4>
<p>This is a tougher one! First let’s calculate the “area” of our bike lanes. We need to make an assumption about the width of our lanes. This <a href="https://vancouver.ca/files/cov/protected-bike-lane-catalogue-part-2-two-way-lanes-and-pathways.pdf">City of Vancouver planning document</a> suggests the bike lanes around Stanley Park are about 3m so let’s go with that.</p>
<p>I’m going to use the <code>.buffer()</code> method to turn the lines of my bike network into polygons with a specified width (3m in our cases). Because my <code>bike_network</code> data is in linear meters units now (remember, I changed the projection), I’m also going to convert our Stanley Park map to that projection (“EPSG:3347”):</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>stanley_park <span class="op">=</span> stanley_park.to_crs(<span class="st">"EPSG:3347"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s “buffer” our bike lanes to be me 3m wide polygons. “Buffer” just mean to add some area around the object:</p>
<p><img src="img/buffer.png" class="img-fluid"></p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">3</span>  <span class="co"># desired with of bike lanes in meters</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>bike_network[<span class="st">"geometry"</span>] <span class="op">=</span> bike_network.<span class="bu">buffer</span>(distance<span class="op">=</span>width <span class="op">/</span> <span class="dv">2</span>)  <span class="co"># note that we provide distance as a radius (half the desired width)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>bike_network</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>name</th>
      <th>length</th>
      <th>bridge</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Stanley Park Causeway</td>
      <td>165.216</td>
      <td>yes</td>
      <td>POLYGON ((4018562.106 2009363.283, 4018563.601...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Stanley Park Causeway</td>
      <td>62.901</td>
      <td>NaN</td>
      <td>POLYGON ((4018554.879 2009389.952, 4018550.455...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>8.066</td>
      <td>NaN</td>
      <td>POLYGON ((4018874.157 2009173.346, 4018874.220...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Stanley Park Drive</td>
      <td>80.558</td>
      <td>NaN</td>
      <td>POLYGON ((4018877.663 2009164.604, 4018883.832...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>91.001</td>
      <td>NaN</td>
      <td>POLYGON ((4018870.301 2009159.558, 4018867.565...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>361</th>
      <td>NaN</td>
      <td>12.670</td>
      <td>NaN</td>
      <td>POLYGON ((4019075.828 2009012.416, 4019075.828...</td>
    </tr>
    <tr>
      <th>362</th>
      <td>NaN</td>
      <td>44.325</td>
      <td>NaN</td>
      <td>POLYGON ((4019065.791 2008999.105, 4019063.426...</td>
    </tr>
    <tr>
      <th>363</th>
      <td>Stanley Park Drive</td>
      <td>3.339</td>
      <td>NaN</td>
      <td>POLYGON ((4017636.250 2008950.892, 4017636.334...</td>
    </tr>
    <tr>
      <th>364</th>
      <td>Park Lane</td>
      <td>29.437</td>
      <td>NaN</td>
      <td>POLYGON ((4017601.662 2009019.800, 4017601.738...</td>
    </tr>
    <tr>
      <th>365</th>
      <td>Stanley Park Drive</td>
      <td>48.880</td>
      <td>NaN</td>
      <td>POLYGON ((4017591.429 2009020.028, 4017591.421...</td>
    </tr>
  </tbody>
</table>
<p>366 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> stanley_park.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>bike_network.plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"tomato"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Stanley Park Cycling"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now we can calculate the area using the <code>.area</code> attribute. Note that <code>geopandas</code> is smart enough to know that you probably want to calculate these spatial attributes on the <code>geometry</code> column, so you don’t actually have to index that particular column (if you have multiple geometry columns, then you can choose which one is “active” and acted on by default using the <code>.set_geometry()</code> method):</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>bike_network_area <span class="op">=</span> bike_network.area.<span class="bu">sum</span>()</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bike path area: </span><span class="sc">{</span>bike_network_area<span class="sc">:.0f}</span><span class="ss"> m2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bike path area: 177968 m2</code></pre>
</div>
</div>
<p>If you think about it, that should be roughly similar to if we just multiplied our <code>total_length</code> from “Question 1” by 3 (the width of the bike paths):</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>total_length <span class="op">*</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>175429.60863417128</code></pre>
</div>
</div>
<p>Well that’s a nice sanity check! Now we just need the area of Stanley Park and we can calculate our ratio:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>stanley_park_area <span class="op">=</span> stanley_park.area</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>bike_network_area <span class="op">/</span> stanley_park_area[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">% of Stanley Park is bike paths."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.45% of Stanley Park is bike paths.</code></pre>
</div>
</div>
</section>
<section id="question-3-what-fsa-in-vancouver-has-the-most-bike-lanes-by-length" class="level4">
<h4 class="anchored" data-anchor-id="question-3-what-fsa-in-vancouver-has-the-most-bike-lanes-by-length">Question 3: What FSA in Vancouver has the most bike lanes (by length)?</h4>
<p>An FSA is a “forward sortation area”, basically a group of postcodes that all start with the same first 3 letters. So to answer this question, we need two things: 1. FSA polygons (available on <a href="https://www12.statcan.gc.ca/census-recensement/2011/geo/bound-limit/bound-limit-2016-eng.cfm">statcan here</a>) 2. The bike network for all of Vancouver</p>
<p>I have already downloaded the above shapefile of FSAs for all of Canada. We’ll load it in and then clip it using our Vancouver polygon:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fsa <span class="op">=</span> gpd.read_file(<span class="st">"data-spatial/fsa"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fsa <span class="op">=</span> fsa.to_crs(<span class="st">"EPSG:4326"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>van_fsa <span class="op">=</span> gpd.clip(fsa, vancouver)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s get the Vancouver bike network using <code>osmnx</code>:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>van_bike_network <span class="op">=</span> ox.graph_from_place(<span class="st">"Vancouver"</span>, network_type<span class="op">=</span><span class="st">"bike"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>van_bike_network <span class="op">=</span> (ox.graph_to_gdfs(van_bike_network, nodes<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                      .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                      .loc[:, [<span class="st">"name"</span>, <span class="st">"length"</span>, <span class="st">"bridge"</span>, <span class="st">"geometry"</span>]]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at our data so far:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> van_fsa.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>van_bike_network.plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"tomato"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Vancouver Cycling"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Okay so how do we work out the total length of bike lanes in each FSA? We need to do a spatial join, which joins two geometries based on their locations. In the plot below, we’ll join the column of the dark dot to the column(s) of the grey polygon because the dark dot is contained within the spatial region of the polygon.</p>
<p><img src="img/spatial-join.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Source: <a href="https://gisgeography.com/spatial-join/">GISGeography</a>.</p>
</blockquote>
<p>We can do a spatial join with <code>gpd.sjoin()</code> (it’s just like joining in base <code>pandas</code>). There are different options for the argument <code>op</code> which allow you how to control the join. Below I’ll specify “contain”, meaning I only want to join when a bike lane is fully contained within an FSA (you can read more about <code>op</code> in the <a href="https://geopandas.org/docs/user_guide/mergingdata.html#sjoin-arguments">documentation</a>);</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>joined_data <span class="op">=</span> gpd.sjoin(van_fsa, van_bike_network, how<span class="op">=</span><span class="st">"inner"</span>, op<span class="op">=</span><span class="st">"contains"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>joined_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>CFSAUID</th>
      <th>PRUID</th>
      <th>PRNAME</th>
      <th>geometry</th>
      <th>index_right</th>
      <th>name</th>
      <th>length</th>
      <th>bridge</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1386</th>
      <td>V5Z</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.11483 49.26939, -123.11482 49.2...</td>
      <td>14683</td>
      <td>West 49th Avenue</td>
      <td>113.479</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1386</th>
      <td>V5Z</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.11483 49.26939, -123.11482 49.2...</td>
      <td>11256</td>
      <td>West 49th Avenue</td>
      <td>113.479</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1386</th>
      <td>V5Z</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.11483 49.26939, -123.11482 49.2...</td>
      <td>11211</td>
      <td>West 49th Avenue</td>
      <td>115.184</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1386</th>
      <td>V5Z</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.11483 49.26939, -123.11482 49.2...</td>
      <td>11257</td>
      <td>West 49th Avenue</td>
      <td>115.184</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1386</th>
      <td>V5Z</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.11483 49.26939, -123.11482 49.2...</td>
      <td>11214</td>
      <td>Fremlin Street</td>
      <td>51.729</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1615</th>
      <td>V6R</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.21376 49.27669, -123.21346 49.2...</td>
      <td>48960</td>
      <td>NaN</td>
      <td>221.171</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1615</th>
      <td>V6R</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.21376 49.27669, -123.21346 49.2...</td>
      <td>48957</td>
      <td>NaN</td>
      <td>105.284</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1615</th>
      <td>V6R</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.21376 49.27669, -123.21346 49.2...</td>
      <td>54169</td>
      <td>NaN</td>
      <td>105.284</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1615</th>
      <td>V6R</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.21376 49.27669, -123.21346 49.2...</td>
      <td>40455</td>
      <td>NaN</td>
      <td>292.839</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1615</th>
      <td>V6R</td>
      <td>59</td>
      <td>British Columbia / Colombie-Britannique</td>
      <td>POLYGON ((-123.21376 49.27669, -123.21346 49.2...</td>
      <td>1231</td>
      <td>NaN</td>
      <td>292.839</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>57907 rows × 8 columns</p>
</div>
</div>
</div>
<p>Now we just need to <code>.groupby()</code>:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(joined_data[[<span class="st">"CFSAUID"</span>, <span class="st">"length"</span>]].groupby(by<span class="op">=</span><span class="st">"CFSAUID"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                                   .<span class="bu">sum</span>()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                                   .sort_values(<span class="st">"length"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                                   .head()</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>length</th>
    </tr>
    <tr>
      <th>CFSAUID</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>V6P</th>
      <td>348095.253</td>
    </tr>
    <tr>
      <th>V5R</th>
      <td>281367.666</td>
    </tr>
    <tr>
      <th>V5X</th>
      <td>264815.800</td>
    </tr>
    <tr>
      <th>V5S</th>
      <td>259047.140</td>
    </tr>
    <tr>
      <th>V5K</th>
      <td>245773.116</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We see that “V6P” has the largest length of bike lanes, what FSA is that?</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> van_fsa.plot(edgecolor<span class="op">=</span><span class="st">"0.2"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>van_fsa.query(<span class="st">"CFSAUID == 'V6P'"</span>).plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"0.2"</span>, color<span class="op">=</span><span class="st">"tomato"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"FSA with most bike lane length"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Looks good to me!</p>
</section>
</section>
</section>
<section id="working-with-raster-data" class="level2">
<h2 class="anchored" data-anchor-id="working-with-raster-data">3. Working with raster data</h2>
<p>Unlike vector data (geometric objects: like points, lines, polygons), raster data is a matrix of values of “pixels” (also called “cells”). Each cell represents a small area and contains a value representing some information:</p>
<p><img src="img/raster.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Source: <a href="https://github.com/NEONScience/NEON-Data-Skills">National Ecological Observatory Network</a>.</p>
</blockquote>
<p>Raster data is like digital image data you look at on your computer, except that now, each pixel represents a spatial region. The “resolution” of a raster is the area that each pixel represents. A 1 meter resolution raster means that each pixel represents a 1 m x 1 m area on the ground. However, when we say “high resolution” we often mean, a low value of resolution for each pixel, i.e., 1 meter resolution is higher than 8 meter resolution as exmplified by the image below:</p>
<p><img src="img/raster-resolution.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Source: <a href="https://github.com/NEONScience/NEON-Data-Skills">National Ecological Observatory Network</a>.</p>
</blockquote>
<p>Like vector data, there are different file formats for storing raster data. The most common is GeoTIFF (<code>.tif</code>), which is essentially an image file with georeferencing information embedded within it. Raster data is used for a variety of problems, common examples include satellite imagery and digital elevation models. Those things are gettings a bit outside the scope of this course but let’s briefly look at some raster data below. The core packge for working with raster data in Python is <a href="https://rasterio.readthedocs.io/en/latest/index.html">rasterio</a>.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I have a satellite image raster file of part of UBC in my data folder which I downloaded from the <a href="https://abacus.library.ubc.ca/dataset.xhtml?persistentId=hdl:11272.1/AB2/6PFOWL">Abacus Data Network</a>. Let’s load it in with <code>rasterio</code>:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> rasterio.<span class="bu">open</span>(<span class="st">"tif/ubc-481E_5456N/481E_5456N.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can start to investigate things like the width and height (in pixels/cells) of the raster:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Width: </span><span class="sc">{</span>dataset<span class="sc">.</span>width<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Height: </span><span class="sc">{</span>dataset<span class="sc">.</span>height<span class="sc">}</span><span class="ss"> pixels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Width: 10000 pixels
Height: 10000 pixels</code></pre>
</div>
</div>
<p>Raster data often have “bands” representing different information (for example, a colour image usually has red, green, and blue bands). This particular satellite image has 4 bands (in order: red, blue, green, infrared):</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dataset.count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>4</code></pre>
</div>
</div>
<p>We could import the first band as a numpy array using:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>band1 <span class="op">=</span> dataset.read(<span class="dv">1</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>band1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>array([[ 70,  67,  52, ...,  88,  86,  85],
       [ 64,  60,  53, ...,  89,  88,  92],
       [ 67,  63,  62, ...,  93, 104, 107],
       ...,
       [ 58,  56,  54, ...,  52,  28,  20],
       [ 55,  56,  55, ...,  55,  30,  25],
       [ 54,  57,  59, ...,  30,  19,  29]], dtype=uint8)</code></pre>
</div>
</div>
<p>But before importing anymore data, it’s helpful to just see the image. First I’m going to “downsample” my raster (reduce the resolution by increasing the cell size) to reduce the size of the data and speed things up a bit:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>rescale_factor <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="op">=</span> dataset.read(out_shape<span class="op">=</span>(dataset.count, <span class="bu">int</span>(dataset.height <span class="op">*</span> rescale_factor),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="bu">int</span>(dataset.width <span class="op">*</span> rescale_factor))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Scaled shape: </span><span class="sc">{</span>scaled_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Scaled shape: (4, 5000, 5000)</code></pre>
</div>
</div>
<p>As our data is just numpy array(s), we can plot it with the <code>matplotlib</code> function <code>plt.imshow()</code>:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>cmaps <span class="op">=</span> [<span class="st">"Reds"</span>, <span class="st">"Blues"</span>, <span class="st">"Greens"</span>, <span class="st">"Purples"</span>]</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>bands <span class="op">=</span> [<span class="st">"Red Band"</span>, <span class="st">"Blue Band"</span>, <span class="st">"Green Band"</span>, <span class="st">"Infrared Band"</span>]</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> band <span class="kw">in</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    ax[band].imshow(scaled_data[band, :, :], cmap<span class="op">=</span>cmaps[band])</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    ax[band].set_title(bands[band])</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    ax[band].axis(<span class="st">"off"</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Of course, it looks more realistic using all channels:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(np.moveaxis(scaled_data, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)[:, :, :<span class="dv">3</span>])</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"All bands"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><code>rasterio</code> has lots of advanced fucntionality for manipulating and plotting raster data if you find the need to. <a href="https://rasterio.readthedocs.io/en/latest/index.html">Check out the documentation</a>.</p>
</section>
<section id="coordinate-reference-systems" class="level2">
<h2 class="anchored" data-anchor-id="coordinate-reference-systems">4. Coordinate reference systems</h2>
<hr>
<p>Generally speaking a coordinate reference system is how we project the 3D surface of the Earth onto a 2D shape for easy viewing</p>
<p><img src="img/projection.gif" class="img-fluid"></p>
<p>There are <a href="https://en.wikipedia.org/wiki/List_of_map_projections">many different projections</a> and they are typically identified by an <a href="https://epsg.io/">EPSG code</a>. No projection is perfect (it’s impossible to perfectly flatten a 3d sphere) and each comprises on minimzing the distortion of shapes, distances, and areas of the Earth. At a basic level, all you need to know is that some projections are: - in angular units (degrees of latitude and longitude) and are good for locating places on Earth, for making global maps, and minimizing shape distortion. The most common is WGS 84 (“<a href="https://epsg.io/4326">EPSG:4326</a>”) - in linear units (e.g., meters) and are good for measuring distances. Most common is UTM which splits the Earth into different linear regions, the code for the region encompassing British Columbia is “<a href="https://epsg.io/32610">EPSG:32610</a>”</p>
<p>But many countries/regions use other specific projections which minimize distortion of that specific area. For example Statistics Canada uses the Lambert projection for Canada (“<a href="https://epsg.io/3347">EPSG:3347</a>”). Much of the time, you will know or be told which projection to use based on your specific data/project.</p>
<p>Let’s take a quick look at some different projections for Canada now:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data from geopandas</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>canada <span class="op">=</span> gpd.read_file(gpd.datasets.get_path(<span class="st">'naturalearth_lowres'</span>)).query(<span class="st">"name == 'Canada'"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">12</span>))</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>crs_list <span class="op">=</span> [(<span class="st">"WGS 84"</span>, <span class="st">"EPSG:4326"</span>), (<span class="st">"Lambert"</span>, <span class="st">"EPSG:3347"</span>), (<span class="st">"UTM 10N"</span>, <span class="st">"EPSG:32610"</span>)]</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, (name, epsg) <span class="kw">in</span> <span class="bu">enumerate</span>(crs_list):</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    canada.to_crs(epsg).plot(ax<span class="op">=</span>axs[n])</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    axs[n].set_title(name)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="chapter1_intro-to-spatial_files/figure-html/cell-49-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><img src="img/bye.png" class="img-fluid"></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>